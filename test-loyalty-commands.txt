// Test Customer Loyalty System in Laravel Tinker
// Run: php artisan tinker
// Then copy and paste these commands one by one:

// 1. Create a test customer
$customer = App\Models\Customer::findOrCreateByPhone('+855123456789', 'John Doe', '123 Main Street');
echo "Customer: {$customer->name} ({$customer->phone})\n";
echo "Initial points: {$customer->available_points}\n";

// 2. Test points calculation
$points = App\Models\Customer::calculatePointsFromAmount(150);
echo "Points for \$150: {$points}\n";

// 3. Add points for $150 purchase
$customer->addPoints($points, null, 150);
$customer->refresh();
echo "Points after \$150 purchase: {$customer->available_points}\n";
echo "Total spent: \${$customer->total_spent}\n";

// 4. Test $75 purchase (should earn 0 points)
$points2 = App\Models\Customer::calculatePointsFromAmount(75);
echo "Points for \$75: {$points2}\n";
$customer->addPoints($points2, null, 75);
$customer->refresh();
echo "Points after \$75 purchase: {$customer->available_points}\n";
echo "Total spent: \${$customer->total_spent}\n";

// 5. Use 1 point
$redeemed = $customer->usePoints(1);
$customer->refresh();
echo "Redeemed: \${$redeemed}\n";
echo "Remaining points: {$customer->available_points}\n";

// 6. Show points history
$history = $customer->pointsHistory()->orderBy('created_at', 'desc')->get();
foreach ($history as $record) {
    echo "{$record->type}: {$record->points} points - {$record->description}\n";
}